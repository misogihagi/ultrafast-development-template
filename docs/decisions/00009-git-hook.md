## はじめに

- [決定](#決定)
- [ステータス](#ステータス)
- [背景](#背景)
- [想定される影響](#想定される影響)
- [検討した他の選択肢](#検討した他の選択肢)
- [参考文献](#参考文献)
- [結果](#結果)

## 決定

Git フックを利用する。具体的には lefthook を使う。

## ステータス

### <img src="https://raw.githubusercontent.com/FortAwesome/Font-Awesome/refs/heads/6.x/svgs/regular/circle-check.svg" width="10" alt="承認済み" /> 承認済み

## 背景

### なぜ lefthook や husky を使うのか

lefthook や husky のようなツールを使う主な理由は、Git の**フック**と呼ばれる機能をより簡単に、そしてチームで一貫して利用するためです。

### Git フックとは

Git には標準でフック機能が備わっていますが、そのままではいくつか課題があります。lefthook や husky のようなツールは、これらの課題を解決し、より効果的にフックを活用できるようにします。

1.  **設定の共有と管理の簡素化**:

    - 標準の Git フックは、`.git/hooks/`ディレクトリに直接スクリプトを配置するため、チームメンバー間で設定を共有したり、プロジェクトのバージョン管理システムに含めたりするのが困難です。
    - lefthook や husky は、`package.json`（Husky の場合）や YAML ファイル（Lefthook の場合）などの**プロジェクトのルートディレクトリにある設定ファイル**を通じてフックを管理します。これにより、設定をリポジトリに含めることができ、チーム全員が同じフックを簡単に利用できるようになります。

2.  **一貫した品質の維持**:

    - これらのツールを使うことで、コミット前に必ずコードフォーマッター（Prettier など）や Linter（ESLint など）が実行されるように設定できます。これにより、個々の開発者の設定に依存せず、**プロジェクト全体のコードスタイルと品質を統一**できます。
    - テストが自動的に実行されることで、バグのあるコードやテストが失敗するコードがプッシュされるのを防ぎ、CI/CD パイプラインでのエラーを減らすことができます。

3.  **開発体験の向上**:

    - 開発者がコードをコミットまたはプッシュする際に、自動的に必要なチェックが実行されるため、手動で Linter やテストを実行する手間が省けます。
    - 問題が早期に発見されるため、後から大規模な修正を行う必要が減り、開発の効率が向上します。

4.  **機能と柔軟性**:
    - **並列実行**: lefthook は Go で書かれており、複数のフックを並列で実行できるため、特に大規模なプロジェクトでフックの実行時間を大幅に短縮できます。Husky は通常、フックを順番に実行しますが、`lint-staged`などのツールと組み合わせることでパフォーマンスを最適化できます。
    - **言語非依存**: lefthook は Go で書かれているため、JavaScript プロジェクトだけでなく、Go、Ruby、Python など、さまざまな言語のプロジェクトで利用できます。一方、Husky は Node.js 製であり、JavaScript プロジェクトとの相性が良いです。
    - **柔軟な設定**: 特定のファイルにのみフックを適用したり、特定の条件でフックをスキップしたりするなど、より詳細な設定が可能です。

簡単に言えば、lefthook や husky は、Git フックの強力な機能をチーム開発に組み込み、**コード品質の向上、開発ワークフローの自動化、そして一貫性の確保**をサポートするツールです。

## 想定される影響

使いづらい人もいるかもしれない。
例えばチェックが多くなるにつれて時間がかかる。
どうしても今すぐ変更したい場合もあるかもしれないが、それより入れたほうが有益だと思う。
また、その時はメンテナーが手動で更新する。

## 検討した他の選択肢

Git フックの管理ツールとして、**lefthook**、**Husky**、そして**pre-commit.com が提供する`pre-commit`フレームワーク**はどれも非常に人気があります。それぞれに特徴があり、プロジェクトのニーズや開発チームの好みによって最適な選択肢が異なります。

以下にそれぞれの比較をまとめます。

---

### 1. Husky

- **概要**: JavaScript/Node.js のエコシステムで最も広く使われている Git フックマネージャーです。
- **言語**: Node.js
- **設定ファイル**: `package.json`または`.husky/`ディレクトリ内のシェルスクリプト
- **特徴**:
  - **Node.js プロジェクトとの親和性**: `npm`や`yarn`で簡単にインストールでき、`package.json`にフックの設定を記述できるため、Node.js プロジェクトに非常に馴染みます。
  - **シンプルさ**: 設定が非常にシンプルで、Git フックをシェルスクリプトとして直接記述できます。
  - **`lint-staged`との組み合わせ**: ステージングされているファイルのみに対して Linter や Formatter を実行するために、`lint-staged`という別のツールと組み合わせて使用されることが一般的です。これにより、コミット時にすべてのファイルをチェックするのではなく、変更されたファイルのみを対象にすることができます。
  - **依存関係**: Node.js に依存します。プロジェクトが Node.js ベースでない場合、Node.js をインストールする必要がある点がデメリットになることがあります。
  - **並列実行**: 基本的にはフックを順番に実行しますが、`lint-staged`などのツールと組み合わせることで、部分的な並列実行は可能です。

### 2. lefthook

- **概要**: 高速で汎用的な Git フックマネージャーです。
- **言語**: Go
- **設定ファイル**: `lefthook.yml` (YAML 形式)
- **特徴**:
  - **高速性**: Go 言語で書かれているため、非常に高速に動作し、複数のフックを**並列**で実行する機能が強力です。特に大規模なプロジェクトでフックの実行時間が長い場合に真価を発揮します。
  - **言語非依存**: 単一のバイナリとして動作するため、Node.js、Ruby、Python、Go など、どのプログラミング言語のプロジェクトでも利用できます。特定の言語ランタイム（Node.js など）を別途インストールする必要がありません。
  - **柔軟な設定**: ステージングされたファイル、特定のパターンに一致するファイル、すべてのファイルなど、フックを実行する対象ファイルを細かく制御できます。また、コマンドのパイプライン処理や、特定のフックのスキップなど、豊富な設定オプションがあります。
  - **個人設定の上書き**: `lefthook-local.yml`というファイルを使って、開発者個人の環境でフックの設定を上書きできる機能があります。これにより、特定のフックをスキップしたり、パラメータを変更したりすることが可能です。
  - **モノレポへの対応**: モノレポ（monorepo）環境でも、各サブプロジェクトに cd してコマンドを実行するような複雑な設定なしに、単一の設定ファイルでフックを管理しやすいです。

### 3. pre-commit (フレームワーク)

- **概要**: 多言語対応の Git フック管理フレームワークです。特定のツールを抽象化して提供する点が特徴です。
- **言語**: Python (ただし、フック自体は多言語対応)
- **設定ファイル**: `.pre-commit-config.yaml` (YAML 形式)
- **特徴**:
  - **多言語対応**: Python ツールではありますが、ESLint (JavaScript)、Black (Python)、Go fmt (Go) など、様々な言語の Linter や Formatter、その他のツールをフックとして利用できます。
  - **フックの管理と依存関係の分離**: 各フック（Linter や Formatter など）は、`pre-commit`フレームワークによって独立した仮想環境にインストールされ、管理されます。これにより、プロジェクトの依存関係を汚染することなく、ツールのバージョン管理や実行が容易になります。
  - **自動更新**: 設定されているフックのバージョンを自動的に更新する機能があります。
  - **既存フックの豊富さ**: 公式サイトや GitHub 上に、多くの一般的な開発ツールに対応したフックが提供されており、手軽に導入できます。
  - **キャッシュ機能**: フックの実行結果をキャッシュすることで、再実行時の速度を向上させることができます。
  - **設定の複雑さ**: Husky や lefthook と比較すると、特定のツールを`pre-commit`の「フック」として設定する必要があるため、慣れるまで少し学習コストがかかるかもしれません。

---

### 比較表

| 特徴                 | Husky                                           | lefthook                                                     | pre-commit (フレームワーク)                                |
| :------------------- | :---------------------------------------------- | :----------------------------------------------------------- | :--------------------------------------------------------- |
| **主な言語**         | Node.js                                         | Go                                                           | Python (多言語フック対応)                                  |
| **設定ファイル**     | `package.json`, `.husky/` シェルスクリプト      | `lefthook.yml` (YAML)                                        | `.pre-commit-config.yaml` (YAML)                           |
| **インストール**     | `npm` / `yarn`                                  | バイナリ (`brew`, `scoop` などでも)                          | `pip`                                                      |
| **高速性/並列実行**  | 基本的に逐次実行（`lint-staged`併用で部分並列） | **非常に高速**、**並列実行**に強み                           | **並列実行**（デフォルトで）                               |
| **言語依存性**       | Node.js に依存                                  | **言語非依存**                                               | Python に依存するがフックは多言語対応                      |
| **使いやすさ**       | シンプルで Node.js プロジェクトに馴染む         | 柔軟性が高く、多機能。設定は YAML で記述                     | フックの抽象化により、学習コストがやや高め                 |
| **主なユースケース** | Node.js/フロントエンドプロジェクト全般          | どの言語のプロジェクトでも、高速性や並列実行が求められる場合 | 多言語プロジェクト、フックの依存関係を厳密に管理したい場合 |
| **追加機能**         | なし（`lint-staged`などで補完）                 | 個人設定の上書き、パイプライン実行                           | フックの依存関係管理、自動更新、キャッシュ                 |

---

### どのツールを選ぶべきか？

- **Node.js/フロントエンドプロジェクトでシンプルさを重視するなら:**
  **Husky** + `lint-staged`の組み合わせが非常に一般的で、導入も簡単です。

- **言語に関わらず、高速性や並列実行、柔軟な設定を重視するなら:**
  **lefthook**が優れた選択肢です。特にフックの実行時間が気になる大規模プロジェクトや、様々な言語が混在するモノレポ環境に適しています。

- **多言語プロジェクトで、各ツールの依存関係を厳密に分離・管理したいなら:**
  **`pre-commit`フレームワーク**が最適です。多くの一般的な開発ツールに対応したフックが提供されており、導入の手間を省けます。

今回は Node.js プロジェクトかどうかはわからず言語非依存で行きたい、さらに高速に動作する。lefthook を採用。

## 参考文献

## 結果

VSCode でコミットされるとチェックされずにコミットされた。

[info] > git -c user.useConfigOnly=true commit --quiet --allow-empty-message --file - [1003ms]
[info] Can't find lefthook in PATH
Can't find lefthook in PATH
[info] > git config --get commit.template [0ms]
[info] > git config --get commit.template [3ms]
[info] > git for-each-ref --format=%(refname)%00%(upstream

ちぇっくうんたら
vscode warning setlocale cannot change locale
https://github.com/microsoft/vscode/issues/110322
